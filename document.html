<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizza Documento - Aura Docs</title>
    <link rel="icon" href="images/auradocs.svg" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Roboto:wght@300;400;700&family=Open+Sans:wght@300;400;600&family=Playfair+Display:wght@400;700&family=Courier+Prime&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <style>
        :root {
            --aura-primary: #e008f6;
            --aura-secondary: #803afb;
            --aura-gradient: linear-gradient(135deg, #e008f6 0%, #803afb 100%);
            --bg-main: #f4f5f8;
            --bg-card: #ffffff;
            --text-main: #1a1b1e;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --border: #e5e7eb;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.06);
            --shadow-lg: 0 12px 40px rgba(0,0,0,0.1), 0 4px 12px rgba(0,0,0,0.06);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-main: #0d0e11;
                --bg-card: #16181d;
                --text-main: #f1f3f5;
                --text-secondary: #8b95a1;
                --text-muted: #5a6272;
                --border: #252830;
                --shadow-lg: 0 12px 40px rgba(0,0,0,0.5);
            }
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        body { 
            background-color: var(--bg-main); 
            color: var(--text-main); 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }

        /* ── HEADER ── */
        header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 28px;
            height: 58px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
        }

        .header-left { display: flex; align-items: center; gap: 14px; }

        .brand-logo { 
            width: 34px; 
            height: 34px;
            border-radius: 9px;
        }

        .header-divider {
            width: 1px;
            height: 20px;
            background: var(--border);
        }

        #doc-title { 
            font-weight: 600; 
            font-size: 14px; 
            color: var(--text-main);
            max-width: 400px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .readonly-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            padding: 5px 12px;
            border-radius: 20px;
            border: 1px solid var(--border);
            background: var(--bg-main);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .readonly-badge i { font-size: 10px; }

        .header-brand-link {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 600;
            color: var(--aura-primary);
            text-decoration: none;
            padding: 6px 14px;
            border-radius: 20px;
            background: rgba(224, 8, 246, 0.07);
            transition: all 0.2s ease;
        }
        .header-brand-link:hover { background: rgba(224, 8, 246, 0.14); }

        /* ── STATUS / LOADING ── */
        #status-message { 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            gap: 16px;
            padding: 120px 20px;
            text-align: center;
            animation: fadeIn 0.4s ease;
        }

        .spinner { 
            width: 40px; height: 40px; 
            border: 3px solid rgba(224, 8, 246, 0.12); 
            border-left-color: var(--aura-primary); 
            border-radius: 50%; 
            animation: spin 0.9s linear infinite;
        }

        .status-icon {
            width: 64px; height: 64px;
            border-radius: 20px;
            background: rgba(224, 8, 246, 0.06);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            color: var(--aura-primary);
        }

        #msg-text { 
            font-size: 15px; 
            color: var(--text-secondary);
            font-weight: 500;
            max-width: 320px;
            line-height: 1.6;
        }

        .status-sub {
            font-size: 13px;
            color: var(--text-muted);
        }

        /* ── DOCUMENT CONTAINER ── */
        .doc-wrapper {
            width: 100%;
            max-width: 890px;
            padding: 32px 20px 80px;
            animation: fadeUp 0.5s ease;
        }

        .doc-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .doc-meta-title {
            font-size: 26px;
            font-weight: 700;
            letter-spacing: -0.4px;
            line-height: 1.2;
        }

        .container {
            width: 100%;
            background: var(--bg-card);
            padding: 64px 88px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
            line-height: 1.85;
        }

        #content-viewer { outline: none; }

        /* ── CONTENT TYPOGRAPHY ── */
        #content-viewer h1 { font-size: 2em; font-weight: 700; margin: 0.8em 0 0.4em; letter-spacing: -0.5px; }
        #content-viewer h2 { font-size: 1.5em; font-weight: 600; margin: 0.8em 0 0.4em; }
        #content-viewer h3 { font-size: 1.2em; font-weight: 600; margin: 0.7em 0 0.3em; }
        #content-viewer p { margin-bottom: 0.85em; }
        #content-viewer ul, #content-viewer ol { padding-left: 1.5em; margin-bottom: 0.85em; }
        #content-viewer li { margin-bottom: 0.3em; }
        #content-viewer a { color: var(--aura-primary); text-decoration: underline; text-underline-offset: 3px; }
        #content-viewer strong { font-weight: 700; }
        #content-viewer em { font-style: italic; }
        #content-viewer code {
            font-family: 'Courier Prime', monospace;
            font-size: 0.88em;
            background: rgba(224, 8, 246, 0.07);
            padding: 2px 6px;
            border-radius: 4px;
            color: var(--aura-primary);
        }
        #content-viewer pre {
            background: rgba(224, 8, 246, 0.04);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px 20px;
            overflow-x: auto;
            margin: 1em 0;
        }
        #content-viewer pre code {
            background: none;
            padding: 0;
            color: var(--text-main);
            font-size: 0.9em;
        }
        #content-viewer blockquote {
            border-left: 3px solid var(--aura-primary);
            padding-left: 16px;
            color: var(--text-secondary);
            font-style: italic;
            margin: 1em 0;
        }
        #content-viewer hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 2em 0;
        }
        #content-viewer img { max-width: 100%; border-radius: 8px; }
        #content-viewer table { width: 100%; border-collapse: collapse; margin: 1em 0; }
        #content-viewer th, #content-viewer td { padding: 10px 14px; border: 1px solid var(--border); font-size: 14px; }
        #content-viewer th { background: rgba(224, 8, 246, 0.05); font-weight: 600; }

        /* ── FOOTER ── */
        .doc-footer {
            margin-top: 24px;
            text-align: center;
            font-size: 12px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .doc-footer a { color: var(--aura-primary); text-decoration: none; font-weight: 600; }

        /* ── SCROLLBAR ── */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 99px; }

        /* ── ANIMATIONS ── */
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 600px) {
            .container { padding: 36px 24px; }
            .doc-wrapper { padding: 20px 12px 60px; }
            .doc-meta-title { font-size: 20px; }
            #doc-title { display: none; }
            .header-divider { display: none; }
        }
    </style>
</head>
<body>

<header>
    <div class="header-left">
        <img src="images/auradocs.svg" alt="Aura" class="brand-logo">
        <div class="header-divider"></div>
        <span id="doc-title">Caricamento...</span>
    </div>
    <div style="display:flex; align-items:center; gap:10px;">
        <div class="readonly-badge">
            <i class="fas fa-eye"></i> Solo lettura
        </div>
        <a href="https://aurastudioitalia.it" class="header-brand-link">
            <i class="fas fa-external-link-alt"></i> Aura
        </a>
    </div>
</header>

<div id="status-message">
    <div class="spinner" id="loader"></div>
    <p id="msg-text">Recupero del documento in corso...</p>
</div>

<div class="doc-wrapper" id="doc-container" style="display: none;">
    <div class="doc-meta">
        <div>
            <div class="doc-meta-title" id="doc-meta-title"></div>
        </div>
    </div>
    <div class="container">
        <div id="content-viewer"></div>
    </div>
    <div class="doc-footer">
        <span>Condiviso con</span>
        <a href="https://docs.aurastudioitalia.it">Aura Docs</a>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDsrHAtIh5bsYDHa1wz0LMcmciChAoRikU",
        authDomain: "myauraid-f03c6.firebaseapp.com",
        projectId: "myauraid-f03c6",
        storageBucket: "myauraid-f03c6.appspot.com",
        messagingSenderId: "190478237725",
        appId: "1:190478237725:web:0d39907473f511b85a06f4"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function showError(icon, message, sub = '') {
        const statusEl = document.getElementById('status-message');
        statusEl.innerHTML = `
            <div class="status-icon"><i class="fas fa-${icon}"></i></div>
            <p id="msg-text">${message}</p>
            ${sub ? `<span class="status-sub">${sub}</span>` : ''}
        `;
    }

    async function loadPublicDocument() {
        const urlParams = new URLSearchParams(window.location.search);
        const docId = urlParams.get('id');

        if (!docId) {
            showError('link-slash', 'ID documento mancante nell\'URL.', 'Controlla il link che hai ricevuto.');
            return;
        }

        try {
            const docRef = await db.collection('documents').doc(docId).get();

            if (!docRef.exists) {
                showError('search', 'Documento non trovato.', 'Potrebbe essere stato eliminato o l\'ID non è corretto.');
                return;
            }

            const data = docRef.data();

            if (data.isPublic !== true) {
                showError('lock', 'Documento privato.', 'L\'autore non ha reso pubblico questo documento.');
                return;
            }

            const title = data.title || 'Senza titolo';
            document.title = title + " - Aura Docs";
            document.getElementById('doc-title').textContent = title;
            document.getElementById('doc-meta-title').textContent = title;

            const viewer = document.getElementById('content-viewer');
            viewer.style.fontFamily = data.fontFamily || 'Poppins';
            viewer.style.fontSize = data.fontSize || '16px';
            viewer.innerHTML = marked.parse(data.content || "");

            document.getElementById('status-message').style.display = 'none';
            document.getElementById('doc-container').style.display = 'block';

        } catch (error) {
            console.error("Errore recupero documento:", error);
            showError('bug', 'Errore durante il caricamento.', 'Riprova tra qualche istante.');
        }
    }

    window.onload = loadPublicDocument;
</script>

</body>
</html>
